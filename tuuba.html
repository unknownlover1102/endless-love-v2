<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Tuuba ‚ù§Ô∏è</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background-color: #ffe6f0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    .container {
      width: 90%;
      max-width: 800px;
      background: white;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      text-align: center;
      position: relative;
    }
    h1 {
      color: #d63384;
    }
    .menu-btn {
      position: absolute;
      top: 15px;
      left: 15px;
      font-size: 24px;
      cursor: pointer;
      z-index: 1000;
    }
    .side-menu {
      position: fixed;
      left: -220px;
      top: 0;
      width: 200px;
      height: 100%;
      background: #d63384;
      color: white;
      padding-top: 60px;
      transition: 0.4s;
      box-shadow: 2px 0 5px rgba(0,0,0,0.3);
    }
    .side-menu.open { left: 0; }
    .side-menu a {
      display: block;
      padding: 15px;
      text-decoration: none;
      color: white;
      transition: background 0.3s;
    }
    .side-menu a:hover { background: #a02362; }
    .section { display: none; }
    .section.active { display: block; }
    textarea {
      width: 100%;
      min-height: 120px;
      margin-top: 10px;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 14px;
      resize: vertical;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background: #d63384;
      color: white;
      transition: 0.3s;
    }
    button:hover { background: #a02362; }
    img {
      max-width: 100%;
      border-radius: 15px;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <div class="menu-btn" onclick="toggleMenu()">‚ò∞</div>
  <div class="side-menu" id="sideMenu">
    <a href="#" onclick="showSection('counter')">Saya√ß</a>
    <a href="#" onclick="showSection('diary')">G√ºnl√ºk</a>
    <a href="#" onclick="showSection('game')">G√∂rsel Tahmin</a>
  </div>

  <div class="container">
    <h1>‚ù§Ô∏è Tuuba & Ben ‚ù§Ô∏è</h1>

    <!-- Saya√ß -->
    <div id="counter" class="section active">
      <h2>Kalan G√ºn</h2>
      <div id="countdown">Y√ºkleniyor...</div>
      <button id="minusBtn">-2 G√ºn</button>
      <button id="plusBtn">+7 G√ºn</button>
    </div>

    <!-- G√ºnl√ºk -->
    <div id="diary" class="section">
      <h2>G√ºnl√ºk</h2>
      <p><i>‚ÄúG√ºn√ºm√ºz√º birbirimize anlatalƒ±m, tamam ayrƒ±yƒ±z bana deƒüil buraya anlat ben bakmam.‚Äù</i></p>
      <textarea id="diaryText" placeholder="Bug√ºn nasƒ±ldƒ±? Buraya yaz..."></textarea>
      <button id="saveDiaryBtn">G√∂nder</button>
    </div>

    <!-- G√∂rsel Tahmin -->
    <div id="game" class="section">
      <h2>Fotoƒüraf Tahmini</h2>
      <img src="foto1.jpg" alt="Fotoƒüraf 1">
      <p>Bu fotoƒüraf sana ne hissettiriyor? Tahmin et!</p>
      <textarea placeholder="Tahminini yaz..."></textarea>
    </div>

    <!-- M√ºzik -->
    <div style="margin-top:20px;">
      <audio id="bgMusic" loop autoplay>
        <source src="ask-sarkisi.mp3" type="audio/mpeg">
      </audio>
    </div>
  </div>

  <!-- Ses efektleri -->
  <audio id="plusSound" src="plus.mp3"></audio>
  <audio id="minusSound" src="minus.mp3"></audio>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, addDoc, collection, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD4RumRC4GnOlSTMONGJcAij9-_64LdBGs",
      authDomain: "endless-love-f201c.firebaseapp.com",
      projectId: "endless-love-f201c",
      storageBucket: "endless-love-f201c.firebasestorage.app",
      messagingSenderId: "144384066384",
      appId: "1:144384066384:web:b583d194fba60954fee255"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const countdownEl = document.getElementById("countdown");
    const plusBtn = document.getElementById("plusBtn");
    const minusBtn = document.getElementById("minusBtn");
    const plusSound = document.getElementById("plusSound");
    const minusSound = document.getElementById("minusSound");
    const bgMusic = document.getElementById("bgMusic");
    const saveDiaryBtn = document.getElementById("saveDiaryBtn");
    const diaryText = document.getElementById("diaryText");

    let endDate;

    async function loadCounter() {
      const ref = doc(db, "counter", "main");
      const snap = await getDoc(ref);
      if (snap.exists()) {
        endDate = snap.data().endDate.toDate();
      } else {
        endDate = new Date();
        endDate.setDate(endDate.getDate() + 40);
        await setDoc(ref, { endDate });
      }
      updateCountdown();
    }

    async function saveCounter() {
      const ref = doc(db, "counter", "main");
      await setDoc(ref, { endDate });
    }

    function updateCountdown() {
      const now = new Date();
      const diff = endDate - now;
      const days = Math.ceil(diff / (1000*60*60*24));
      countdownEl.innerText = `${days} G√ºn kaldƒ±`;
    }

    plusBtn.addEventListener("click", async () => {
      const wasPlaying = !bgMusic.paused;
      bgMusic.pause();
      plusSound.play();
      plusSound.onended = () => { if (wasPlaying) bgMusic.play(); };

      endDate.setDate(endDate.getDate() + 7);
      await saveCounter();
      updateCountdown();
    });

    minusBtn.addEventListener("click", async () => {
      const wasPlaying = !bgMusic.paused;
      bgMusic.pause();
      minusSound.play();
      minusSound.onended = () => { if (wasPlaying) bgMusic.play(); };

      endDate.setDate(endDate.getDate() - 2);
      await saveCounter();
      updateCountdown();
    });

    // G√ºnl√ºk kaydet
    saveDiaryBtn.addEventListener("click", async () => {
      const text = diaryText.value.trim();
      if (text) {
        await addDoc(collection(db, "diary"), {
          text,
          createdAt: serverTimestamp()
        });
        diaryText.value = "";
        alert("G√ºnl√ºk kaydedildi!");
      }
    });

    loadCounter();
    setInterval(updateCountdown, 60000);

    // üîä ƒ∞lk tƒ±klamada m√ºzik garantili ba≈ülasƒ±n
    document.body.addEventListener("click", () => {
      if (bgMusic.paused) {
        bgMusic.play();
      }
    }, { once: true });
  </script>

  <script>
    function toggleMenu() {
      document.getElementById("sideMenu").classList.toggle("open");
    }
    function showSection(id) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      toggleMenu();
    }
  </script>
</body>
</html>
